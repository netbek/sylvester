!function(){function n(n,t,e){var a=jsnx[n](t,e),o={nodes:_.map(a.nodes(),function(n){return{id:n,links:0,scale:0}}),links:_.map(a.edges(),function(n){return{source:n[0],target:n[1]}})};_.forEach(o.links,function(n){o.nodes[n.source].links++,o.nodes[n.target].links++});var i=_.minBy(o.nodes,function(n){return n.links}).links,r=_.maxBy(o.nodes,function(n){return n.links}).links,d=d3.scalePow().exponent(c.radiusDistribution).domain([i+1,r+1]).range([c.minRadius,c.maxRadius]),s=d3.scalePow().exponent(c.symbolDistribution).domain([i+1,r+1]).range([0,1]),l=d3.scalePow().exponent(c.fenceDistribution).domain([i+1,r+1]).range([0,1]);return _.forEach(o.nodes,function(n){n.scale=d(n.links+1),n.symbol=Math.round(s(n.links+1))?"logo":"circle",n.hasFence=!!Math.round(l(n.links+1))}),o}function t(n){return _.pick(n,["model","n","p","minRadius","maxRadius","fenceRadius","radiusDistribution","symbolDistribution","fenceDistribution","collisionEnabled","collisionRadius","manyBodyEnabled","manyBodyStrength"])}function e(n){return{nodes:_.map(n.nodes,function(n){return _.pick(n,["id","links","scale","symbol","hasFence","x","y"])}),links:_.map(n.links,function(n){return{source:n.source.id,target:n.target.id}})}}function a(n){function t(){f.attr("x1",function(n){return n.source.x}).attr("y1",function(n){return n.source.y}).attr("x2",function(n){return n.target.x}).attr("y2",function(n){return n.target.y}),R.attr("transform",function(n){var t=y*b*n.scale/2;return"translate("+(n.x-t)+","+(n.y-t)+")"})}function e(){var n=d3.event.transform;l.attr("transform","translate("+n.x+","+n.y+")")}function a(n){d3.event.active||p.alphaTarget(.3).restart(),n.fx=n.x,n.fy=n.y}function r(n){n.fx=d3.event.x,n.fy=d3.event.y}function d(n){d3.event.active||p.alphaTarget(0),n.fx=null,n.fy=null}m.selectAll("*").remove();var s=d3.zoom().scaleExtent([1,1]).on("zoom",e);p=d3.forceSimulation().force("link",d3.forceLink().id(function(n){return n.id})).force("center",d3.forceCenter(g/2,h/2)),c.collisionEnabled&&o(),c.manyBodyEnabled&&i(),m.call(s);var l=m.append("g"),f=l.append("g").selectAll("line").data(n.links).enter().append("line").attr("stroke","#FFF").attr("stroke-width",1),R=l.append("g").selectAll("circle").data(n.nodes).enter().append("g").call(d3.drag().on("start",a).on("drag",r).on("end",d));R.append("g").each(function(n){var t=this;u[n.symbol].selectAll("*").each(function(){t.appendChild(this.cloneNode(!0))})}).attr("transform",function(n){return"scale("+b*n.scale+")"}),R.append("circle").attr("cx",function(n){return y*b*n.scale/2}).attr("cy",function(n){return y*b*n.scale/2}).attr("r",function(n){return y*b*n.scale*c.fenceRadius}).attr("fill","none").attr("stroke-dasharray","5,5").attr("stroke-width",1).attr("stroke","#FFF").attr("display",function(n){if(!n.hasFence)return"none"}),p.nodes(n.nodes).on("tick",t),p.force("link").links(n.links)}function o(){p.force("collide",c.collisionEnabled?d3.forceCollide().radius(function(n){return y*b*n.scale/2*c.collisionRadius}):_.noop)}function i(){p.force("charge",c.manyBodyEnabled?d3.forceManyBody().strength(c.manyBodyStrength):_.noop)}function r(n,t){return d([JSON.stringify(n,null,2)],t+".json","text/plain;charset="+document.characterSet)}function d(n,t,e){window.URL=window.URL||window.webkitURL;var a=new Blob(n,{type:e}),o=window.URL.createObjectURL(a),i=document.body,r=document.createElement("a");i.appendChild(r),r.setAttribute("download",t),r.setAttribute("href",o),r.style.display="none",r.click(),r.parentNode.removeChild(r),setTimeout(function(){window.URL.revokeObjectURL(o)},10)}function s(){f=n(c.model,c.n,c.p),a(f)}var c={model:"fastGnpRandomGraph",n:50,p:.05,minRadius:.75,maxRadius:4,fenceRadius:1.2,radiusDistribution:1.5,symbolDistribution:2,fenceDistribution:4,collisionEnabled:!0,collisionRadius:3,manyBodyEnabled:!1,manyBodyStrength:-50,"Stop simulation":function(){p.stop()},"Restart simulation":function(){p.restart()},"Regenerate graph":function(){s()},"Save config":function(){r(t(c),"config")},"Save data":function(){r(e(f),"graph")},"Save SVG":function(){d3_save_svg.save(m.node(),{filename:"graph"})}},l=_.clone(c),u={};_.forEach(["circle","logo"],function(n){u[n]=d3.select("#"+n+" > svg")});var f,p,m=d3.select("svg.stage"),g=+m.attr("width"),h=+m.attr("height"),y=512,b=8/y,R=new dat.GUI,k=R.addFolder("Graph");k.add(c,"model",{"G(n, p)":"gnpRandomGraph","G(n, p) (fast)":"fastGnpRandomGraph"}).onChange(function(n){l.model!==n&&(l.model=n,s())}),k.add(c,"n",5,100).step(1).onChange(function(n){l.n!==n&&(l.n=n,s())}),k.add(c,"p",0,1).step(.01).onChange(function(n){l.p!==n&&(l.p=n,s())}),k.add(c,"minRadius",.05,5).step(.05).onChange(function(n){l.minRadius!==n&&(l.minRadius=n,s())}),k.add(c,"maxRadius",.05,5).step(.05).onChange(function(n){l.maxRadius!==n&&(l.maxRadius=n,s())}),k.add(c,"radiusDistribution",.1,3).step(.1).onChange(function(n){l.radiusDistribution!==n&&(l.radiusDistribution=n,s())}),k.add(c,"fenceRadius",1,2).step(.1).onChange(function(n){l.fenceRadius!==n&&(l.fenceRadius=n,s())}),k.add(c,"fenceDistribution",.1,6).step(.1).onChange(function(n){l.fenceDistribution!==n&&(l.fenceDistribution=n,s())}),k.add(c,"symbolDistribution",.1,6).step(.1).onChange(function(n){l.symbolDistribution!==n&&(l.symbolDistribution=n,s())}),k.open();var v=R.addFolder("Forces");v.add(c,"collisionEnabled").onChange(function(n){l.collisionEnabled!==n&&(l.collisionEnabled=n,o(),p.stop().alphaTarget(.3).restart())}),v.add(c,"collisionRadius",1,4).step(.1).onChange(function(n){l.collisionRadius!==n&&(l.collisionRadius=n,o(),p.stop().alphaTarget(.3).restart())}),v.add(c,"manyBodyEnabled").onChange(function(n){l.manyBodyEnabled!==n&&(l.manyBodyEnabled=n,i(),p.stop().alphaTarget(.3).restart())}),v.add(c,"manyBodyStrength",-500,0).step(1).onChange(function(n){l.manyBodyStrength!==n&&(l.manyBodyStrength=n,i(),p.stop().alphaTarget(.3).restart())}),v.open(),R.add(c,"Stop simulation"),R.add(c,"Restart simulation"),R.add(c,"Regenerate graph"),R.add(c,"Save config"),R.add(c,"Save data"),R.add(c,"Save SVG"),s()}();